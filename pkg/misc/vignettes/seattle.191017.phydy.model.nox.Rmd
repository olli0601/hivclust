---
title: "**Phylodynamic analysis: transmission dynamics between US born and foreign born individuals in King County Seattle**"
output: 
  html_document:
    code_folding: hide
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
```{r, include=TRUE, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, tidy=TRUE}
require(knitr)
require(kableExtra)
require(ggplot2)
```
```{r, include=FALSE, eval=FALSE, echo=FALSE, warning=FALSE, message=FALSE, tidy=TRUE}
require(rmarkdown)
setwd('~/git/hivclust/pkg/misc/vignettes') 
rmarkdown::render('seattle.191017.phydy.model.nox.Rmd')
```
```{r, include=TRUE, eval=TRUE, echo=FALSE, warning=FALSE, message=FALSE, tidy=TRUE}
read_chunk('~/git/hivclust/pkg/misc/hivclu.Seattle.R')		
```

## **Epidemiologic model, local population**
The overall aim is to specify an epidemic model that captures transmission
dynamics among heterosexuals by migrant-status. Consider the following states
$$
(S^j_{gi}, I^j_{gi}, T^j_{gi})
$$ 
where $S$, $I$, $T$ denote respectively groups of susceptible, infected and
treated individuals and 

* $j$ denotes location, respectively $l$ (local, King County) or $x$
(external, world) 
* $g$ denotes gender, respectively $m$ (male) and $j$
(female) 
* $i$ denotes migration status. This can be ethnicity, respectively
$0$ (white) and $1$ (non-white). Or alternatively location of birth,
respectively $0$ (US-born) and $1$ (foreign-born). 

Our basic ODE equations for the transmission dynamics involving the local
susceptible population are 
$$
\begin{align}
    \dot{S}^l_{f0} &= - (\beta_{00} I^l_{m0}+\beta_{10} I^l_{m1} ) S^l_{f0} /N^l + \mu (S^l_{f0}/S^l) - \mu S^l_{f0} \\
    \dot{S}^l_{f1} &= - (\beta_{01} I^l_{m0}+\beta_{11} I^l_{m1} ) S^l_{f1} /N^l + \mu (S^l_{f1}/S^l) - \mu S^l_{f1}\\
    \dot{S}^l_{m0} &= - (\beta_{00} I^l_{f0}+\beta_{10} I^l_{f1} ) S^l_{m0} /N^l + \mu (S^l_{m0}/S^l) - \mu S^l_{m0} \\
    \dot{S}^l_{m1} &= - (\beta_{01} I^l_{f0}+\beta_{11} I^l_{f1} ) S^l_{m1} /N^l + \mu (S^l_{m1}/S^l) - \mu S^l_{m1}\\ 
\end{align}
$$
where 

* $\mu$ is the birth/death rate
* $S^l = S^l_{f0} + S^l_{f1} + S^l_{m0} + S^l_{m1}$
* $N^l$ is the sum of all compartments involving the local population
* $\beta_{ij}$ is the transmission rate from individuals with migration status
  $i$ to migration status $j$.

The remaining model equations involving the local population are  
$$
\begin{align}
    \dot{I}^l_{f0} &= (\beta_{00} I^l_{m0}+\beta_{10} I^l_{m1} ) S^l_{f0} /N^l - \gamma I^l_{f0} - \mu I^l_{f0} \\
    \dot{I}^l_{f1} &= (\beta_{01} I^l_{m0}+\beta_{11} I^l_{m1} ) S^l_{f1} /N^l - \gamma I^l_{f1} - \mu I^l_{f1}\\
    \dot{I}^l_{m0} &= (\beta_{00} I^l_{f0}+\beta_{10} I^l_{f1} ) S^l_{m0} /N^l - \gamma I^l_{m0} - \mu I^l_{m0} \\
    \dot{I}^l_{m1} &= (\beta_{01} I^l_{f0}+\beta_{11} I^l_{f1} ) S^l_{m1} /N^l - \gamma I^l_{m1} - \mu I^l_{m1}\\
    \dot{T}^l_{f0} &= \gamma I^l_{f0} - \mu T^l_{f0} \\
    \dot{T}^l_{f1} &= \gamma I^l_{f1} - \mu T^l_{f1}\\
    \dot{T}^l_{m0} &= \gamma I^l_{m0} - \mu T^l_{m0} \\
    \dot{T}^l_{m1} &= \gamma I^l_{m1} - \mu T^l_{m1}\\ 
\end{align}
$$
where

* $\gamma$ is the rate at which infected individuals become virally suppressed due to
antiretrovirals. We assume that infected individuals that reached viral
suppression remain suppressed until death.

The above is a fairly standard two-group SIR model. Let us explore performance
of phylodynamic parameter estimates on this model before we move on to more
complicated things.


## **Phylodynamic implementation**
Using standard notation, we define the $m=4$ demes backwards in time by
$$
\boldsymbol{Y}(t)= \big(  I^l_{f0}(t), I^l_{f1}(t), I^l_{m0}(t), I^l_{m1}(t)\big).
$$
The population sizes in the demes are further influenced by the non-deme
variables
$$
\boldsymbol{Y}^\prime(t)= \big(  S^l_{f0}(t), S^l_{f1}(t), S^l_{m0}(t), S^l_{m1}(t), T^l_{f0}(t), T^l_{f1}(t), T^l_{m0}(t), T^l_{m1}(t)\big).
$$
The birth matrix corresponding to the ODE model above is
$$
\boldsymbol{F}(t,\boldsymbol{Y}, \boldsymbol{Y}^\prime)= 
\left[\begin{array}
{rrrrr}
0 & 0 & \beta_{00}I^l_{m0}S^l_{f0}/N^l & \beta_{10}I^l_{m1}S^l_{f0}/N^l \\
0 & 0 & \beta_{01}I^l_{m0}S^l_{f1}/N^l & \beta_{11}I^l_{m1}S^l_{f1}/N^l \\
\beta_{00}I^l_{f0}S^l_{m0}/N^l & \beta_{10}I^l_{f1}S^l_{m0}/N^l & 0 & 0 \\
\beta_{01}I^l_{f0}S^l_{m1}/N^l & \beta_{11}I^l_{f1}S^l_{m1}/N^l & 0 & 0 \\
\end{array}\right],
$$
where we ommitted dependencies on time on the right hand side.
The entry $F_{ij}(t)$ describes the rate at which individuals in deme $i$ are generated by individuals in deme $j$.
The migration matrix corresponding to the ODE model above is
$$
\boldsymbol{G}(t,\boldsymbol{Y}, \boldsymbol{Y}^\prime)= 
\left[\begin{array}
{rrrrr}
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
\end{array}\right].
$$
The entry $G_{ij}(t)$ describes the rate at which individuals in deme $i$ migrate from individuals in deme $j$.
The death vector corresponding to the ODE model above is
$$
\boldsymbol{\mu}(t,\boldsymbol{Y}, \boldsymbol{Y}^\prime)= 
\left[\begin{array}
{r}
(\gamma+\mu) I^l_{f0} \\
(\gamma+\mu) I^l_{f1} \\
(\gamma+\mu) I^l_{m0} \\
(\gamma+\mu) I^l_{m1} \\
\end{array}\right].
$$
The non-deme dynamics are given by
$$
\boldsymbol{N}(t,\boldsymbol{Y}, \boldsymbol{Y}^\prime)= 
\left[\begin{array}{r}
\mu*N^l*\frac{S_{f0}}{S^l_{f0}+S^l_{f1}+S^l_{m0}+S^l_{m1}} - \mu*S^l_{f0} - \beta*(\beta_{00}*I^l_{m0}+\beta_{10}*I^l_{m1})*S^l_{f0}/N^l \\
\mu*N^l*\frac{S_{f1}}{S^l_{f0}+S^l_{f1}+S^l_{m0}+S^l_{m1}} - \mu*S^l_{f1} - \beta*(\beta_{01}*I^l_{m0}+\beta_{11}*I^l_{m1})*S^l_{f1}/N^l \\
\mu*N^l*\frac{S_{m0}}{S^l_{f0}+S^l_{f1}+S^l_{m0}+S^l_{m1}} - \mu*S^l_{m0} - \beta*(\beta_{00}*I^l_{f0}+\beta_{10}*I^l_{f1})*S^l_{m0}/N^l \\
\mu*N^l*\frac{S_{m1}}{S^l_{f0}+S^l_{f1}+S^l_{m0}+S^l_{m1}} - \mu*S^l_{m1} - \beta*(\beta_{01}*I^l_{f0}+\beta_{11}*I^l_{f1})*S^l_{m1}/N^l \\
\gamma*I^l_{f0} - \mu*T^l_{f0}\\
\gamma*I^l_{f1} - \mu*T^l_{f1}\\
\gamma*I^l_{m0} - \mu*T^l_{m0}\\
\gamma*I^l_{m1} - \mu*T^l_{m1}\\
\end{array}\right].
$$


The phylodynamic model has 12 states for the local population with initial
values to be specified, and parameters 
$$
(\beta, \beta_{00}, \beta_{01}, \beta_{10}, \beta_{11}, \gamma, \mu),
$$
of which $1$ is over-specified. Our first goal is to explore inference of 
$$
(\beta, \beta_{00}, \beta_{01}, \beta_{10}),
$$
with all other parameters set to the true values in simulations. 

 
## **Simulations**
The following table describes the parameter values and initial values that we
fixed throughout in simulations:
$$
\begin{align}
N^l(0)= & 10^6 & \text{population size Seattle}\\
p_F= & 0.5 & \text{proportion female}\\
s^l= & S^l(0) / N^l(0)= 0.99 & \text{proportion susceptibles}\\
i^l= & I^l(0) / N^l(0)= 0.01*0.2 & \text{proportion infectious}\\
\mu= & 1/40 & \text{birth-death rate}
\end{align} 
$$
The simulations varied in terms of the WAIFM matrix
$$
\boldsymbol{B}= 
\left[\begin{array}
{rrrrr}
\beta_{00} & \beta_{01} \\
\beta_{10} & \beta_{11}\\
\end{array}\right]
$$
in which rows sum to $1$. This means we can interpret $\beta_{ij}$ as the
conditional probability that given an infected class $i$ individual, he
transmits to a susceptible in class $j$ rather than any of the other classes. I
then used endemic equilibrium conditions to determine the model parameters:
$$
\begin{align}
\beta= & 2*\mu*\frac{1-s^l}{i^l s^l}\frac{ \beta_{00}+\beta_{11}-\beta_{01}- \beta_{10} }{ \beta_{00}*(\beta_{11}-\beta_{10})+\beta_{10}*(\beta_{00}-\beta_{01}) }\\
\gamma= & \mu*(1-s^l-i^l)/i^l\\
\end{align} 
$$
and initial conditions:
$$
\begin{align}
p_0= & \frac{\beta_{11}-\beta_{10}}{\beta_{00}+\beta_{11}-\beta_{01}-\beta_{10}} & \text{proportion in class 0}\\
S^l_{f0}= & p_0*p_F*s^l*N^l(0) & \text{number female susceptibles in class 0}\\
S^l_{f1}= & (1-p_0)*p_F*s^l*N^l(0) & \text{number female susceptibles in class 1}\\
S^l_{m0}= & p_0*(1-p_F)*s^l*N^l(0) & \text{number male susceptibles in class 0}\\
S^l_{m1}= & (1-p_0)*(1-p_F)*s^l*N^l(0) & \text{number male susceptibles in class 1}\\
I^l_{f0}= & p_0*p_F*i^l*N^l(0) & \text{number female infectious in class 0}\\
I^l_{f1}= & (1-p_0)*p_F*i^l*N^l(0) & \text{number female infectious in class
1}\\ 
I^l_{m0}= & p_0*(1-p_F)*i^l*N^l(0) & \text{number male infectious in class 0}\\ 
I^l_{m1}= & (1-p_0)*(1-p_F)*i^l*N^l(0) & \text{number male infectious in class 1}\\
T^l_{f0}= & p_0*p_F*(1-s^l-i^l)*N^l(0) & \text{number female treated in class 0}\\
T^l_{f1}= & (1-p_0)*p_F*(1-s^l-i^l)*N^l(0) & \text{number female treated in class 1}\\ 
T^l_{m0}= & p_0*(1-p_F)*(1-s^l-i^l)*N^l(0) & \text{number male treated in class 0}\\ 
T^l_{m1}= & (1-p_0)*(1-p_F)*(1-s^l-i^l)*N^l(0) & \text{number male treated in class 1}\\
\end{align} 
$$

## **Simulation scenarios 1 and 2**
I first wanted to see if the following two scenarios can be distinguished: 

* Scenario 1: no spread between class $0$ and $1$, i.e. 
$$
\boldsymbol{\omega}= 
\left[\begin{array}
{rrrrr}
1 & 0 \\
0 & 1\\
\end{array}\right]
$$


* Scenario 2: (almost) homogeneous spread between classes $0$ and $1$, i.e. 
$$
\boldsymbol{\omega}= 
\left[\begin{array}
{rrrrr}
0.55 & 0.45 \\
0.45 & 0.55\\
\end{array}\right]
$$
while keeping all else equal. In other words, we have exactly the same epidemic
trajectories at endemic equilibrium for each of the demes and non-demes, but
the flow dynamics are different.


## **Inference log book 2019-12-19 **

I simulated tree data using

* an epidemic running for 50 years, `t0=0` and `t1=50`;
* simulating trees both under a deterministic and stochastic process model at `res=1000`;
* taking $100$, $500$, $1000$ samples from the population obtained in the last $10$
years of an epidemic simulation run.

The code to generate the simulations was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01.sim>>
```

### Scenario 1 simulated data {.tabset}

#### Simulated epidemic trajectories

The simulated trajectories of the demes and non-demes are at equilibrium as specified, and the same as in scenerio 2. Here are the simulations under the stochastic process model.
```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
#knitr::include_graphics(c("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_trajectories.pdf","/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_trajectories.pdf"))
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_trajectories.pdf")
```

#### Simulated onward spread by class ($\omega$ matrix)

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_waifm.pdf")
```

#### Simulated trees

From these simulations, I created 

* $100$ each trees for $100$, $500$, $1000$ sampled individuals;
* under deterministic and stochastic process models at `res=1e3`;

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_dettree_sample100_1.pdf")
```

### Scenario 2 simulated data {.tabset}

#### Simulated epidemic trajectories

The simulated trajectories of the demes and non-demes are at equilibrium as specified, and the same as in scenerio 1. Here are the simulations under the stochastic process model.
```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
#knitr::include_graphics(c("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_trajectories.pdf","/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim1_trajectories.pdf"))
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim2_trajectories.pdf")
```

#### Simulated onward spread by class ($\omega$ matrix)

Hovering around 50%: 
```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim2_waifm.pdf")
```

#### Simulated trees

From these simulations, I created $100$ trees of $100$ sampled individuals,
$100$ trees of $500$ sampled individuals, and $100$ trees of $1000$ sampled
individuals. Tree with $100$ taxa:

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_sim/sim2_dettree_sample100_1.pdf")
```

### Phylodynamic inference

I then re-estimated the parameters
$$
\beta, \beta_{10}, \beta_{01}, \beta_{11}.
$$
I fixed $\beta_{00}=1$ to avoid parameter collinearity and kept all other parameters at their true values. I optimised the log of the parameters to ensure that the estimated
parameters are non-negative on their natural scale.

Inferences was done using:

* deterministic demographic process model with `res=200`, `forgiveAgtY = 0`, `AgtY_penalty = Inf`, `step_size_res =10`,`likelihood='PL2'` (for both deterministic and stochastic simulations)
* setting `maxheight` to 1 year above the root to cut out the large polytomy in the simulations, that corresponds to $>1$ initial cases.

The code for phylodynamic inference was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01.mle>>
```

I first plotted the relative difference between the likelihood of the simulated tree under true parameters (ll\_sim) and the likelihood of the simulated tree under ML parameters (ll\_MLE) versus mean absolute error MAE. 

* The relative difference in the likelihoods was large for 100 samples, suggesting that we need to consider more data.
* The MAE was good in scenario 1 but not good in scenario 2. This was interesting!
* The MAE was similar on deterministic and stochastic simulations.

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01_mle/runs_MAE.pdf")
```

I talked to Erik, he wrote

* It's a bit odd to be doing this using a small portion of the tree (since the coalescent sim is far from reaching the root). I'm really not sure how much error that can introduce; there isn't good theory  for it. I use the maxheight option on a regular basis, but this usually only excludes a small number of coalescent events; in your case it looks like more than half 
Why don't you run the simulation for longer so you don't have to truncate the tree so much? More coalescent events -> more power
* Is MLE error associated with `res` parameter in the SDE simulations? Try increasing `res` 
* Finally, I don't think this is a great model for studying migration since there's not a persistent flow from the global reservoir; it's a bit as though a migrant population was dumped into 'local' at t=0 and then they act as an independent risk group. But maybe you are getting around to adding those details in. 


## **Inference log book 2020-02-25 **

I simulated tree data using

* an epidemic running for 2e4 years, `t0=0` and `t1=20000`;
* however there were severe simulation errors under the deterministic process model at this time scale, and I don t show results at this time scale.

The code to generate the simulations was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01.longsim>>
```

### Simulated data {.tabset}

#### Scenario 1, simulated epidemic trajectories

Simulations under the deterministic process model.
```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01long_sim/sim1_trajectories_det.pdf")
```

#### Scenario 2, simulated epidemic trajectories

Simulations under the deterministic process model.
```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE}
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01long_sim/sim2_trajectories_det.pdf")
```


## **Inference log book 2020-02-27 **

I simulated tree data using

* an epidemic running for 100, 200, 400 years;
* simulating trees under a deterministic process model at `res=1000`;
* taking $1000$ samples from the population obtained in the last 60\%, 40\%, 20% of the epi simulation.

These deterministic simulations were at equilibrium.

The code to generate the simulations was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01yrsXX.sim>>
```

I then re-estimated the parameters
$$
\beta, \beta_{10}, \beta_{01}, \beta_{11}.
$$
I fixed $\beta_{00}=1$ to avoid parameter collinearity and kept all other parameters at their true values. I optimised the log of the parameters to ensure that the estimated
parameters are non-negative on their natural scale.

Inferences was done using:

* deterministic demographic process model with increasing `res=200`, `res=400`, `res=600`, `res=1000`, and increasing `step_size_res=10`, `step_size_res=100`. The other parameters were `forgiveAgtY = 0`, `AgtY_penalty = Inf`, `likelihood='PL2'`.
* setting `maxheight` to 1 year above the root to cut out the large polytomy in the simulations, that corresponds to $>1$ initial cases.

The code for phylodynamic inference was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01yrsXX.mle>>
```

I first plotted the relative difference between the likelihood of the simulated tree under true parameters (ll\_sim) and the likelihood of the simulated tree under ML parameters (ll\_MLE) versus mean absolute error MAE. 

* For scenario 1 (which was good before), I found that with increasing epidemic length, there was increasing relative difference in the likelihood values.
* For scenario 1, this increase in relative difference in the likelihood values was associated with larger MAE.
* For scenario 1, MAE was only good for epidemics of length up to 100 years, and this was not different when samples were taken over different time scales, nor using different `res` or `step_size_res` parameters.
* For scenario 2 (which was not good before), there was no such increasing relative difference in the likelihood values.
* For scenario 2, the MAE was still all over the place

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01yrsXX_mle/runs_MAE.pdf")
```


## **Inference log book 2020-03-17 **

I simulated tree data using

* an epidemic running for 50, 100 years;
* simulating trees under a stochastic and deterministic process model at `res=1000`;
* taking $1000$ samples from the population obtained in the last 40\%, 20% of the epi simulation.

These deterministic simulations were at equilibrium.

The code to generate the simulations was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01yrsXXv3.sim>>
```

I then re-estimated the parameters
$$
\beta, \beta_{10}, \beta_{01}, \beta_{11}.
$$
I fixed $\beta_{00}=1$ to avoid parameter collinearity and kept all other parameters at their true values. I optimised the log of the parameters to ensure that the estimated
parameters are non-negative on their natural scale.

Inferences was done using:

* a deterministic demographic process model with increasing `res=200`, `res=1000`, fitted to the deterministic epidemics. The other parameters were `forgiveAgtY = 0`, `AgtY_penalty = Inf`, `step_size_res=10`, `likelihood='PL2'`. A stochastic demographic process model with increasing `res=200`, `res=1000`, fitted to the stochastic epidemics. 
* setting `maxheight` to 1 year above the root to cut out the large polytomy in the simulations, that corresponds to $>1$ initial cases.

The code for phylodynamic inference was:
```{r, include=TRUE, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE,tidy=FALSE} 
<<rmd.chunk.seattle.191017.phydyn.olli.SITmf01yrsXXv3.mle>>
```

I first plotted the relative difference between the likelihood of the simulated tree under true parameters (ll\_sim) and the likelihood of the simulated tree under ML parameters (ll\_MLE) versus mean absolute error MAE. 

* For scenario 1, the inferences using a stochastic model on stochastic epidemics are always associated with relative difference in the likelihood values.
* For scenario 2, this is not the case.

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01yrsXXv3_mle/runs_MAE_sc12.pdf")
```

I then plotted the estimated MLEs for each of the four parameters (colour and boxplot) against the true values (horizontal bars) in scenario 1. 
The xaxis shows epidemic lengths 50 and 100 years. The row panels show inferences using a stochastic model on stochastic epidemics, and a deterministic model on deterministic epidemics, for different `res` parameters.

* For scenario 1, using a deterministic model on deterministic epidemics gave good inferences.
* For scenario 1, using a stochastic model on stochastic epidemics did not give good inferences.

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01yrsXXv3_mle/accuracy_marginals_simid1_simyrs40.pdf")
```

I then plotted the same results for scenario 2. 

* For scenario 2, I obtained good inferences using either a deterministic model on deterministic epidemics or a stochastic model on stochastic epidemics.

```{r, include=TRUE, out.width="90%", out.height="500", fig.show='hold', fig.align='centre', echo=FALSE} 
knitr::include_graphics("/Users/or105/Box/OR_Work/Seattle/phydyn_olli/olli_SITmf01yrsXXv3_mle/accuracy_marginals_simid2_simyrs40.pdf")
```
